---
title: 浅析swiper初始化遇到的一个问题
date: 2018-07-02 20:36:05
tags:
  - swiper
  - js
categories:
  - js
---

最近的项目里，有个图片展示模块，采用了著名的swiper轮播框架来做，具体需求是这样的，在已百度地图为底图的页面上，会展示一些景区的热点，点这些热点，会弹出一个景区详情的弹窗，弹窗里有个查看大图的区域，点击即可进入图片展示模块。

按照正常的开发流程，以正常的逻辑，首先获取这些景点列表，景点会带有特殊的id，在点击热点的时候，利用id去查询这些热点相对应的景点详情数据，在景点详情的数据里，带有图片展示模块的img路径数组，只要将img数组，传入图片展示模块swiper进行初始化，就可以了。

但是，这么做，有一个问题，按照上面的流程来的话，那么点击大图区域，才会触发swiper的初始化，才会去请求图片们所对应的的路径，这样会对用户体验造成一定的影响，页面在加载图片的过程中，会出现一定时间的等待，以及停顿，其实在开发过程中，自测的图片路径，都是本地的，所以看不出来差异，但是一放到测试环境，那这种处理逻辑就GG了，毕竟算是一名小司机了，在这方面遇到的坑，还是有些的。

当然有处理办法了，你们肯定要说，最常规的，就如同我前面博客里写到的那样，利用图片的预加载啊懒加载啊啥的，优化加载体验啊，但在这里，我偏偏不用这个办法，因为相比于常规的，直接一次点击就要初始化图片的情况，这里的情况，其实是这样的，当打开弹窗的时候，实际上，图片的路径数据已经过来了，这时候，图片展示模块还没有出现，所以，本人的处理思路是这样的：

* **1、首先将原本在图片区域点击后初始化swiper的代码，迁移到弹窗打开后的逻辑中**
* **2、那么图片区域点击只是给图片展示模块移除display:none的类，让其显示**  
* **3、在图片展示区域关闭的事件中，销毁swiper对象，并且，隐藏图片展示模块的wrap层**

按照上面的思路，就很清晰了，实际上，获取图片路径，加载图片，初始化swiper的工作，被提到了弹窗打开之后，这样就完美的摆脱了图片加载的问题，因为用户点开弹窗之后，并不会立即点开图片区域，让图片展示模块出现，因此，给了图片加载可乘之机，哈哈哈

但实际上，按照这样的逻辑，去开发之后，在测试的时候，可以看出来，非常完美的解决了加载等待的问题，嗯，效果好像还不赖。。。但是，我点点看呢，结果悲剧了，swiper的按钮根本就失效了好伐？？！！一定是swiper初始化的过程出了问题。。。嗯。。。

仔细思考了下，难道是和我swiper的wrap一开始的时候是display:none有关么？因此我试着将一开始这个属性给抹去，让他在弹窗打开后，就显示，看看有没有正常初始化，如果是正常的，则说明就是display:none的问题，经过测试，确实是这样的。当swiper初始化容器，位于一个display:none的元素里时，其初始化，是存在一些问题的，不管是什么问题，反正交互是不奏效的了已经。。。那么如何去在这样的场景里去解决这样一个问题呢？

首先一点，要明确，图片展示的swiper不可能页面一加载，就初始化显示，这是不符合当初的需求的，那么仔细想想看，既然是swiper初始化的时候，找不到display:none的元素才导致的初始化失败，那么，有怎么样的方式，才能达到，既隐藏，又能顺利被swiper初始化呢？答案就是下面这个属性：

```css
ele {
  visibility:hidden;
}
```

其实啊，这个属性，和display:none类似，类似在，表现形式是一样的，都是在界面上隐藏元素，让用户看不到。只不过前者仍然可以获取到元素，后者就是完全消失不见了。因此，swiper的初始化，才不会奏效啊，哈哈哈，透过现象看本质，原来问题的根源是如此的简单而渺小，渺小到容易被忽视。

因此，以后啊，再遇到像我这样的需求情况的时候，初始化一个容器进行swiper加载的时候，让容器隐藏，千万不要使用display:block;而是用visibility:hidden，一样可以达到预期的效果。

