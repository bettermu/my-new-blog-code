---
title: 关于在一体机中浏览器手势缩放导致百度地图失效的问题
date: 2018-10-19 21:22:24
tags:
  - 交互  手势缩放
categories:
  - 一体机 
  - win7触摸屏
---

最近在处理之前开发的语音导览系统以及产业链数据展示系统，在一体机环境里兼容运行的问题。

项目主要也就是java web 前后端半分离式开发，从开发到测试，一直都是在笔记本和大屏上面，浏览器和鼠标进行操作，所以，直到部署上线前，所有的问题都是按照电脑上的浏览器测试部署好的。

现场使用的一体机，是win7操作系统的，1920 1080 全高清触控屏，还好当时页面是按照这个尺寸写的，所以，在现场的实际展示效果，页面基本的布局和样式，是没有任何问题的。

目前唯一比较坑的事情，就是，由于项目中使用了百度地图，所以，在触控屏上面，手势是要支持地图缩放的，但由于当时我们条件有限，只能在电脑上用滚轮测试地图缩放是正常的，就下意识的认为，在一体机的触控屏上面，肯定也是正常的，但后来发现，还是太年轻了。。。

当时由于是一体机展示，所以，没考虑过任何兼容的问题，默认是chrome效果展示最好，对开发也最为友善，因此统一使用的chrome进行后期项目部署的展示。但后来发现，实际上面，显示效果都是完美的，但是，对于一体机的手势放大缩小操作，竟然是放大缩小页面！！！不是缩放地图！！！  wtf？？？  这到底是为什么？？？

猜测了下，应该是chrome对于一体机操作手势的识别误判？？？我们开发的hybrid APP 里面也同样用到的地图，但是，手势识别的是放大缩小地图，而不是放大缩小页面，而且，最关键的是，百度地图的首页，在一体机的chrome里打开，不仅可以完美的缩放，还特么的可以旋转？？！！！简直就是完美啊，个人猜测，应该是百度地图首页，并不是完全按照js api 实现的，而是通过了更底层的东西，实现的，直接跨过了win7一体机手势操作在chrome下是缩放页面的操作。

后来在百度地图论坛上面，找了下类似的问题反馈，竟然还有不少，但是回答都是令人失望的：目前来说，在windows一体机上面，手势缩放，chrome里就是缩放页面，而不是缩放地图。目前百度地图在一体机的浏览器里，只能通过缩放控件进行地图缩放，但是这样对于需求来说，简直就是太不方便了。因为这对用户体验，极为不友好，而且，还不能进行地图拖动，只能控件缩放，不能拖动，那全部数据就很难展示完整啊。这样肯定是不行的。

你们肯定特别好奇，最后问题是怎么解决掉的呢，其实尝试了很多办法，比如，在chrome快捷方式的属性里，目标的输入框中，加入 --disable pinch，意图是通过禁止掉chrome的缩放功能，看看能不能达到地图自己缩放的效果，但实际上是行不通的，实际的效果是，根本连缩放都不能响应了。另外一个是加上viewport 属性  也就是众人皆知的 userscable=no  这样也尝试了，还是照样行不通的，最后能怎么办呢？

其实说来也是好玩的，特别幸运的是，由于微软的捆绑式操作，每个windows系统，出厂前，都会带上自家的IE浏览器，这是大家都知道的，而win7一体机也是如此，携带了IE11浏览器，抱着死马当活马医的心态，在IE11里打开了项目地址，突然发现，地图可以自由的缩放了？？！！！为什么会这样？？？私以为大概是IE浏览器内部识别手势的方式是和chrome不太一样的，在一体机的ie浏览器里，手势缩放，屏幕会出现和PC上面滚轮缩放一样效果的小手图案，所以，这特么就是想要的效果啊！！

但是问题又来了，当时开发的时候，就是因为不考虑IE，所以，开发节奏相当流畅顺滑，但是现在特别搞笑的是，为了能让项目顺利交付，竟然不得不用IE，哎，能怎么办呢，赶紧排查下IE的兼容问题吧，还好是IE11，代码里基本都是可以完美兼容的，除了一个问题，就是webkit内核专属的多行文本截断属性，在IE所有的浏览器里，都是要跪的。解决方法也很简单，如同张鑫旭博客里写的那样，定高，然后overflow hidden,然后通过js进行操作，如果是IE，就在最后一行，补上伪元素的 ... ，具体也不自己写了，但是解决这个问题，引用了一个js库，专门解决多行文本截断的兼容性问题，具体可以自行百度。

但是另外还有问题，IE也不是完全完美的，当浏览器里出现文本的时候，手势缩放文本，照样还是会放大缩小页面，不过这个问题，解决起来就很简单了，随便百度一下，就得到了解决办法，就是修改注册表里IE浏览器的相关属性，然后对滚轮缩放属性进行禁止，就可以了，具体操作可以自行百度。

就这么一个问题，用语言描述了这么多，可见当时身在此山中的慌张啊，真的是。没想到，到最后竟然是IE救了这个项目，哈哈哈，不过想来也是，IE总是不走寻常路，大概是为了想着，多占点市场吧，特别是一体机的市场。2333...