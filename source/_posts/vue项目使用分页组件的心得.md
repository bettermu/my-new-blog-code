---
title: vue项目使用分页组件的心得
date: 2018-12-20 21:37:59
tags:
  - vue
  - vuejs-paginate
categories:
  - vue  
  - pagination
---


最近在新的项目里，使用了vue全家桶来进行开发，之前公司的前端技术栈基本就是jq，这次的新项目是个新闻资讯网站，用vue来上手开发，应该不难，就当是个入门级的练手项目。

当然，第一次的开发过程，总是会遇到各种各样的问题，今天要跟大家分享的是一个很常见的功能，就是列表的分页。既然是资讯网，那么很多场景下面，都会需要用到分页，而PC端，基本就是分页按钮式的交互，移动端则是上拉下拉加载刷新的交互。由于我负责的是pc端的实现，因此来分享下，PC端分页的心得。

一般来说，像前端分页这种功能，在网上都会有大量的轮子可以使用，但是良莠不齐，需要细心分辨，一开始，我选用的分页组件是基于vue的[v-page](https://github.com/TerryZ/v-page)，具体的使用，可以根据它的[文档](https://terryz.gitee.io/vue/#/page)来按步骤完成，虽然这个分页控件star数不多，但我实际使用起来，还是感觉非常方便的，只需要传入相应的props，就可以完成正常的分页数据的交互，而且是按页加载的。

如果，一切都像上面用的那么顺利，那我现在就不应该再继续往下分享了，大功告成很嗨皮啊，但是，有些时候，项目的复杂度，是不能单单靠这些单薄的轮子可以支撑的，在我自以为完成功能之后的几天，测试就打过来了一个bug，说是分页数据会乱掉，当时我是不太信的，后来run了一下项目，检查了下，发现问题是这样的：

首先，我们这个资讯网项目，有两种不同的分页情况：

* 类似列表页的这种，全局的接口请求只有唯一一个，因此数据接口是单一的

* 类似分类列表的这种，如下图，它是需要根据左侧的分类id去分别查询相应的列表信息，因此，数据接口是多个的，而且不固定，当时考虑到代码的简洁性，肯定全局只能用一个分页组件，然后，根据不同的接口回来的数据，去更新信息列表以及分页组件。

![](https://github.com/bettermu/blog-picture-store/blob/master/20181220/1.png?raw=true)

测试所发现的问题是这样的，问题出现在第二种情况的页面里，也就是存在多个数据接口动态获取列表数据的情况：

首先，假如，我当前的分类下面，商品数量超过一页10条的数据，当我点击第二页的时候，此时展示的是当前分类的第二页的数据，这是没毛病的，但是然后当我再切换左侧的分类，那么，应该重新去获取另一个分类的数据，而且是要按照页码默认是第一页去取，这一步也没毛病，因为我在改变分类的事件的时候，接口调用的是按照第一页的去取，因此展示的也是第一页的数据。但是问题来了，如果这个时候，我再点一下上一页这个按钮，你会发现，神奇的事情是，数据请求了，竟然，而且是第一页的数据。而且，如果第一次的数据多，你点了3,4,5甚至更多的页码，那么再按照之前的操作，跳到一个分类列表数据很少的分页下，点击上一页，你会发现，数据请求了，但是没有数据。简单思考了下，查了下请求，发现，如果上一次请求的是第5页的信息，那么这一顿操作之后，第二次的请求，则是第4页的信息，然而，当前分类下并没有第4页的信息，这才是最重要的问题所在，数据混乱的根源，就在这里，当前的page被组件记住了，而且，我查看了下api，并没有可以重置当前page页码信息的props，基本上可以说，这个组件，是没办法满足当前需求的，那么继续换，反正[vue官方资源](https://github.com/vuejs/awesome-vue)也有很多其他类似的分页插件可以使用。

那么我又花了半天的时间，去查看其他的分页组件的文档，终于物色到了一款，并且试了之后，刚好可以满足当前需求的组件，就是[vuejs-paginate](https://github.com/lokyoung/vuejs-paginate)


这个文档，写的还是很详细的，毕竟star数417 是v-page的十倍还多，具体的使用，可以参照上面的链接里的文档，下面只是说下，如何来解决上述的问题，很明显，我们需要的是，分页组件能够重置当前的页码数，方便我们在重新请求分类列表数据的情况下，都能够重置成最开始的情况，也就是默认第一页的数据，因此，需要这个组件，能够拥有一个改变这个变量的props，那么，仔细阅读文档，会发现，下面这段话：

![](https://github.com/bettermu/blog-picture-store/blob/master/20181220/2.png?raw=true)

是的，v-model这个属性绑定，经过我的简单测试，就是设置组件当前的页码数，因此一切问题迎刃而解了，我们只需要在改变左侧分类栏目的点击事件中，调用一下this.page = 1，将组件内置的page页数给重置回去，就可以了。

## 总结

来做个简单的总结，如果场景里需要的仅仅是一个数据接口回来数据的列表展示，那么使用v-page是完全没有问题的，但是如果场景开始变得复杂，需要根据不同的id去获取不同类型的列表数据，那么我们就需要考虑组件的完备性和可扩展性了，那么还是推荐使用vuejs-paginate这个组件。   

另外，v-page里的样式，不支持外联props扩展，因此，一般在项目里需要做重写，尽可能高的还原ui设计。而vuejs-pagination这个组件，支持props传入className的值，允许我们进行自定义样式的设置，这一点做的还是很到位的。    

前几天，在知乎上看到一个评论，说业务远远没有技术重要，这种言论还是过于偏激了。因为单单从前端方面来说，其实前端还是偏向于业务场景的实现的，是客户和需求最直接的接收者，而技术，只是一种手段，一种达成业务，完善业务，扩展业务的手段，说到业务和技术，其实缺一不可，不可脱离技术谈业务，不然会是空谈，不切实际的。也不能脱离业务谈技术，不然也只能是纸上谈兵，并没有可用之处。
只有二者很好的结合，才能给所在的公司创造价值，才能带来更多的利益。不过技术还是很单纯的，活到老，学到老，共勉。





